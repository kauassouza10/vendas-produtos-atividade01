<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini E-commerce</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body>
  <header class="header">
    <span class="material-symbols-outlined icon">home</span>
    <div id="btn-carrinho" class="cart-icon">
      <span class="material-symbols-outlined icon">shopping_bag</span>
      <span id="cart-count">0</span>
    </div>
  </header>

  <main id="produtos-container"></main>

  <button id="btn-carregar" class="btn-carregar">Carregar mais produtos</button>

  <footer class="footer">
    Todos os direitos reservados
  </footer>

  <!-- Modal do QR Code -->
  <div id="modal-compra" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Pagamento via QR Code</h2>
      <img id="qrcode" src="" alt="QR Code">
      <p>Escaneie o QR Code para concluir a compra.</p>
    </div>
  </div>

  <!-- Modal do Carrinho -->
  <div id="modal-carrinho" class="modal">
    <div class="modal-content">
      <span class="close-carrinho">&times;</span>
      <h2>üõí Seu Carrinho</h2>
      <div id="lista-carrinho"></div>
      <div id="total-carrinho"></div>
      <button id="btn-finalizar" class="btn btn-comprar" style="margin-top:15px;">Finalizar Compra</button>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>

* {
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
  background: #f4f4f4;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ===== HEADER ===== */
.header {
  width: 100%;
  background: #d4b839;
  height: 10vh;
  display: flex;
  align-items: center;
  justify-content: space-around;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 10;
}

.cart-icon {
  position: relative;
}

#cart-count {
  position: absolute;
  top: -5px;
  right: -10px;
  background: red;
  color: white;
  border-radius: 50%;
  font-size: 12px;
  width: 18px;
  height: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ===== FOOTER ===== */
.footer {
  width: 100%;
  height: 10vh;
  background: #d4b839;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-weight: bold;
  font-size: 18px;
  position: fixed;
  bottom: 0;
  left: 0;
  z-index: 10;
}

/* ===== ICONES ===== */
.icon {
  font-size: 40px;
  color: #fff;
  cursor: pointer;
  transition: transform 0.2s;
}

.icon:hover {
  transform: scale(1.1);
}

/* ===== CONTAINER DOS PRODUTOS ===== */
#produtos-container {
  margin-top: 12vh;
  margin-bottom: 12vh;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: stretch;
  gap: 20px;
}

/* ===== CARD ===== */
.card {
  background: #fff;
  border-radius: 10px;
  width: 280px;
  min-height: 450px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  padding: 15px;
  text-align: center;
  transition: transform 0.2s;
}

.card:hover {
  transform: scale(1.03);
}

/* ===== IMAGEM ===== */
.card img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}

/* ===== T√çTULO ===== */
.card h2 {
  font-size: 1.1rem;
  margin: 10px 0 5px;
}

/* ===== DESCRI√á√ÉO ===== */
.card p {
  flex-grow: 1;
  color: #555;
  font-size: 0.9rem;
  margin-bottom: 10px;
}

/* ===== PRE√áO ===== */
.price {
  font-weight: bold;
  color: #27ae60;
  margin: 5px 0;
}

/* ===== RANKING ===== */
.rating {
  color: #f39c12;
  font-weight: bold;
}

/* ===== BOT√ÉO ===== */
.btn-comprar {
  background: #27ae60;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  transition: background 0.2s;
  margin-top: 10px;
}

.btn-comprar:hover {
  background: #1e7c4d;
}

/* ===== BOT√ÉO CARREGAR MAIS ===== */
.btn-carregar {
  margin: 20px 0;
  padding: 12px 24px;
  background: #d4b839;
  border: none;
  color: white;
  font-weight: bold;
  font-size: 1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

.btn-carregar:hover {
  background: #b79e2e;
}

/* ===== MODAL ===== */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
}

.modal-content {
  background: white;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
  text-align: center;
}

.close {
  color: red;
  float: right;
  font-size: 24px;
  cursor: pointer;
}

/* ===== CARRINHO MODAL ===== */
#lista-carrinho {
  max-height: 300px;
  overflow-y: auto;
  text-align: left;
}

.item-carrinho {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #ddd;
}

.item-carrinho span {
  font-size: 0.95rem;
}

.btn-remover {
  background: red;
  border: none;
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.8rem;
}

#total-carrinho {
  margin-top: 10px;
  font-weight: bold;
  text-align: right;
}

let produtos = [];
let produtosExibidos = 0;
const produtosPorPagina = 8;
let carrinho = [];

const container = document.getElementById("produtos-container");
const btnCarregar = document.getElementById("btn-carregar");
const modalCompra = document.getElementById("modal-compra");
const modalCarrinho = document.getElementById("modal-carrinho");
const closeModalCompra = document.querySelector(".close");
const closeModalCarrinho = document.querySelector(".close-carrinho");
const cartCount = document.getElementById("cart-count");
const qrCodeImg = document.getElementById("qrcode");
const btnCarrinho = document.getElementById("btn-carrinho");
const listaCarrinho = document.getElementById("lista-carrinho");
const totalCarrinho = document.getElementById("total-carrinho");
const btnFinalizar = document.getElementById("btn-finalizar");

// ====== BUSCA PRODUTOS ======
fetch("https://dummyjson.com/products")
  .then(res => res.json())
  .then(data => {
    produtos = data.products;
    mostrarProdutos();
  })
  .catch(err => {
    container.innerHTML = "<p>Erro ao carregar produtos.</p>";
    console.error(err);
  });

// ====== MOSTRA PRODUTOS ======
function mostrarProdutos() {
  const novos = produtos.slice(produtosExibidos, produtosExibidos + produtosPorPagina);
  novos.forEach(produto => {
    const card = document.createElement("div");
    card.classList.add("card");
    card.innerHTML = `
      <img src="${produto.thumbnail}" alt="${produto.title}">
      <h2>${produto.title}</h2>
      <p>${produto.description}</p>
      <div class="price">Pre√ßo: R$ ${produto.price}</div>
      <div class="rating">‚≠ê ${produto.rating}</div>
      <div class="btn-container">
        <button class="btn btn-carrinho">Adicionar ao carrinho</button>
        <button class="btn btn-comprar">Comprar</button>
      </div>
    `;
    container.appendChild(card);

    card.querySelector(".btn-carrinho").addEventListener("click", () => adicionarCarrinho(produto));
    card.querySelector(".btn-comprar").addEventListener("click", () => abrirModalCompra(produto));
  });

  produtosExibidos += novos.length;
  if (produtosExibidos >= produtos.length) btnCarregar.style.display = "none";
}

// ====== ADICIONAR AO CARRINHO ======
function adicionarCarrinho(produto) {
  carrinho.push(produto);
  cartCount.textContent = carrinho.length;
  atualizarCarrinho();
}

// ====== ATUALIZAR LISTA DO CARRINHO ======
function atualizarCarrinho() {
  listaCarrinho.innerHTML = "";
  let total = 0;

  carrinho.forEach((item, index) => {
    total += item.price;
    const div = document.createElement("div");
    div.classList.add("item-carrinho");
    div.innerHTML = `
      <span>${item.title} - R$ ${item.price}</span>
      <button class="btn-remover" data-index="${index}">Remover</button>
    `;
    listaCarrinho.appendChild(div);
  });

  totalCarrinho.textContent = `Total: R$ ${total.toFixed(2)}`;

  // evento de remover item
  document.querySelectorAll(".btn-remover").forEach(btn => {
    btn.addEventListener("click", e => {
      const i = e.target.dataset.index;
      carrinho.splice(i, 1);
      cartCount.textContent = carrinho.length;
      atualizarCarrinho();
    });
  });
}

// ====== MODAL CARRINHO ======
btnCarrinho.addEventListener("click", () => {
  atualizarCarrinho();
  modalCarrinho.style.display = "block";
});
closeModalCarrinho.addEventListener("click", () => (modalCarrinho.style.display = "none"));

// ====== MODAL COMPRA (QR CODE) ======
function abrirModalCompra(produto) {
  qrCodeImg.src = `https://api.qrserver.com/v1/create-qr-code/?data=Pagamento%20do%20produto%20${encodeURIComponent(produto.title)}&size=200x200`;
  modalCompra.style.display = "block";
}
closeModalCompra.addEventListener("click", () => (modalCompra.style.display = "none"));

// ====== FINALIZAR COMPRA ======
btnFinalizar.addEventListener("click", () => {
  if (carrinho.length === 0) {
    alert("Seu carrinho est√° vazio!");
    return;
  }
  const listaProdutos = carrinho.map(p => p.title).join(", ");
  qrCodeImg.src = `https://api.qrserver.com/v1/create-qr-code/?data=Pagamento%20dos%20itens:%20${encodeURIComponent(listaProdutos)}&size=200x200`;
  modalCarrinho.style.display = "none";
  modalCompra.style.display = "block";
  carrinho = [];
  cartCount.textContent = 0;
  atualizarCarrinho();
});

// ====== FECHAR MODAIS AO CLICAR FORA ======
window.addEventListener("click", e => {
  if (e.target === modalCompra) modalCompra.style.display = "none";
  if (e.target === modalCarrinho) modalCarrinho.style.display = "none";
});

// ====== CARREGAR MAIS ======
btnCarregar.addEventListener("click", mostrarProdutos);